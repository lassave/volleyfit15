<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VolleyFit 15</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <meta name="theme-color" content="#1565C0"/>
</head>
<body>
  <header class="topbar">
    <h1>VolleyFit 15</h1>
    <button id="installBtn" class="install-btn">Instalar</button>
  </header>

  <nav class="menu">
    <button data-view="plan" class="active">Plan 15 días</button>
    <button data-view="nutrition">Nutrición</button>
    <button data-view="calendar">Calendario</button>
    <button data-view="track">Seguimiento</button>
    <button data-view="pdf">PDF / Export</button>
  </nav>

  <main id="app">
    <section id="view-plan" class="view active">
      <h2>Plan de Entrenamiento - Resumen</h2>
      <div id="planList"></div>
    </section>

    <section id="view-nutrition" class="view">
      <h2>Nutrición</h2>
      <div id="nutrition"></div>
    </section>

    <section id="view-calendar" class="view">
      <h2>Calendario 15 días</h2>
      <div id="calendar"></div>
      <p class="help">Tocá un día para marcarlo como completado y dejar notas.</p>
    </section>

    <section id="view-track" class="view">
      <h2>Seguimiento</h2>
      <form id="trackForm">
        <label>Día: <input type="number" id="tDay" min="1" max="15" value="1"></label>
        <label>Tipo:
          <select id="tType">
            <option value="entreno">Entreno</option>
            <option value="comida">Comida</option>
            <option value="nota">Nota</option>
          </select>
        </label>
        <label>Notas: <input id="tNotes" placeholder="Observaciones"></label>
        <label>Carga (kg): <input id="tLoad" type="number" step="0.5"></label>
        <label>Reps: <input id="tReps" type="number" min="0"></label>
        <label><input type="checkbox" id="tDone"> Completado</label>
        <button type="submit">Agregar / Guardar</button>
      </form>

      <h3>Registros</h3>
      <ul id="records"></ul>
      <button id="clearRecords" class="danger">Borrar todos los registros</button>
    </section>

    <section id="view-pdf" class="view">
      <h2>Exportar</h2>
      <p>Puedes descargar el PDF del plan o exportar tus registros en JSON.</p>
      <button id="downloadPdf">Descargar PDF (versión simple)</button>
      <button id="exportJson">Exportar registros (JSON)</button>
    </section>
  </main>

  <footer>
    <small>VolleyFit 15 — PWA demo • Proyecto lista para GitHub Pages</small>
  </footer>

<script>
// --- Data (plan + nutrition) ---
const PLAN = [
  {day:1, title:"Tren inferior", details:"Sentadilla 4x5; Peso muerto rumano 4x6; Zancadas 3x10; Prensa 3x8; Gemelos 4x12; Saltos al cajón 4x5."},
  {day:2, title:"Tren superior", details:"Press militar manc. 4x5; Dominadas 4x6; Remo 4x8; Press militar 3x6; Face pulls 3x15."},
  {day:3, title:"Agilidad y potencia", details:"Escalera; Sprints 6x15m; Cambios de dirección; Drop jumps 4x4."},
  {day:4, title:"Fuerza total", details:"Peso muerto clásico 4x4; Goblet 3x10; Fondos 3x10."},
  {day:5, title:"Recuperación activa", details:"Bici 20-30min; Estiramientos; Trabajo de hombro."},
  {day:6, title:"Descanso activo / técnica", details:"Trabajo técnico suave."},
  {day:7, title:"Descanso", details:"Descanso completo o técnica muy ligera."},
  {day:8, title:"Inferior explosivo", details:"Sentadilla con salto 4x4; Sentadilla barra 3x4 (60%); Zancadas 3x8; Gemelos 3x12."},
  {day:9, title:"Superior explosivo", details:"Press banca velocidad 5x3; Remo 4x6; Jalón 3x8."},
  {day:10, title:"Último día pesado", details:"Sentadilla 3x3; Peso muerto 3x3; Remo 3x5; Fondos 3x8."},
  {day:11, title:"Pliometría y agilidad", details:"Escalera; Sprints; Saltos verticales 4x4."},
  {day:12, title:"Técnica y movilidad", details:"Saques, recepción, desplazamientos; Estiramientos."},
  {day:13, title:"Activación corta", details:"20min potencia baja; Saltos suaves; Core."},
  {day:14, title:"Descanso", details:"Descanso total."},
  {day:15, title:"Competencia", details:"Entrada en calor: movilidad + sprints cortos + saltos suaves."}
];

const NUTRITION = {
  breakfasts:["Avena + banana + nueces + 3 huevos","Pan integral + palta + huevo poché"],
  lunches:["Pollo 200-250g + arroz integral + ensalada","Carne magra + batata + verduras"],
  snacks:["Yogur griego + fruta + almendras","Licuado proteico + banana + avena"],
  dinners:["Pescado 200g + verduras + batata","Omelette 3 huevos + ensalada + pan integral"]
};

// --- UI Handling ---
function q(sel){return document.querySelector(sel)}
function qa(sel){return document.querySelectorAll(sel)}

function renderPlan(){
  const container = q('#planList'); container.innerHTML='';
  PLAN.forEach(d=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<h3>Día ${d.day} — ${d.title}</h3><p>${d.details}</p><button data-day="${d.day}" class="markDay">Marcar completado</button>`;
    container.appendChild(card);
  });
}
function renderNutrition(){
  const c = q('#nutrition'); c.innerHTML='';
  for(const [k,v] of Object.entries(NUTRITION)){
    const s = document.createElement('div'); s.className='nut';
    s.innerHTML = `<h4>${k}</h4><ul>${v.map(x=>' <li>'+x+'</li>').join('')}</ul>`;
    c.appendChild(s);
  }
}

// --- Calendar ---
function renderCalendar(){
  const cal = q('#calendar'); cal.innerHTML='';
  for(let i=1;i<=15;i++){
    const d = document.createElement('div'); d.className='cal-day';
    d.dataset.day=i;
    const title = PLAN.find(p=>p.day===i)?.title||`Día ${i}`;
    const done = getDayDone(i);
    d.innerHTML = `<strong>Día ${i}</strong><div class="title">${title}</div><div class="done">${done? '✅ Completado' : '❌ Pendiente'}</div>`;
    d.addEventListener('click', ()=> {
      const note = prompt('Notas para el día '+i+' (vacío para no cambiar):','');
      const completed = confirm('Marcar como completado?');
      saveRecord({day:i, type:'entreno', notes: note||'', completed: completed?1:0, carga:null, reps:null});
      renderCalendar(); renderRecords();
    });
    cal.appendChild(d);
  }
}
function getDayDone(day){
  const recs = JSON.parse(localStorage.getItem('vf_records')||'[]');
  return recs.some(r=>r.day===day && r.completed);
}

// --- Tracking (localStorage) ---
function loadRecords(){ return JSON.parse(localStorage.getItem('vf_records')||'[]'); }
function saveRecords(list){ localStorage.setItem('vf_records', JSON.stringify(list)); }
function saveRecord(obj){
  const list = loadRecords();
  obj.id = Date.now();
  obj.date = new Date().toISOString();
  list.unshift(obj);
  saveRecords(list);
}
function renderRecords(){
  const ul = q('#records'); ul.innerHTML='';
  const list = loadRecords();
  if(!list.length) { ul.innerHTML='<li>No hay registros aún.</li>'; return; }
  list.forEach(r=>{
    const li = document.createElement('li');
    li.innerHTML = `<strong>Día ${r.day}</strong> - ${r.type} - ${r.completed?'✅':''} ${r.notes||''} ${r.carga?'- '+r.carga+'kg':''} ${r.reps?'- '+r.reps+' reps':''} <button class="del" data-id="${r.id}">Eliminar</button>`;
    ul.appendChild(li);
  });
  qa('.del').forEach(b=>b.addEventListener('click', e=>{
    const id = Number(e.target.dataset.id);
    const list = loadRecords().filter(x=>x.id!==id);
    saveRecords(list); renderRecords(); renderCalendar();
  }));
}

// --- Form submit
q('#trackForm').addEventListener('submit', e=>{
  e.preventDefault();
  const obj = {
    day: Number(q('#tDay').value),
    type: q('#tType').value,
    notes: q('#tNotes').value,
    carga: q('#tLoad').value?Number(q('#tLoad').value):null,
    reps: q('#tReps').value?Number(q('#tReps').value):null,
    completed: q('#tDone').checked?1:0
  };
  saveRecord(obj);
  renderRecords(); renderCalendar();
  alert('Registro guardado');
  q('#tNotes').value=''; q('#tLoad').value=''; q('#tReps').value='';
});

// clear records
q('#clearRecords').addEventListener('click', ()=>{
  if(confirm('Borrar todos los registros?')) { localStorage.removeItem('vf_records'); renderRecords(); renderCalendar(); }
});

// menu navigation
qa('.menu button').forEach(b=>{
  b.addEventListener('click', ()=>{
    qa('.menu button').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    const view = b.dataset.view;
    qa('.view').forEach(v=>v.classList.remove('active'));
    q(`#view-${view}`).classList.add('active');
  });
});

// download PDF (simple)
q('#downloadPdf').addEventListener('click', ()=>{
  let text = 'VolleyFit 15 - Plan de 15 días\\n\\n';
  PLAN.forEach(p=> text += `Día ${p.day} - ${p.title}\\n${p.details}\\n\\n`);
  const blob = new Blob([text], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='volleyfit_plan.txt'; document.body.appendChild(a); a.click(); a.remove();
});

// export JSON
q('#exportJson').addEventListener('click', ()=>{
  const data = loadRecords();
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='volleyfit_records.json'; document.body.appendChild(a); a.click(); a.remove();
});

// install prompt for PWA (deferred)
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e)=> {
  e.preventDefault();
  deferredPrompt = e;
  q('#installBtn').style.display='inline-block';
});
q('#installBtn').addEventListener('click', async ()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    const resp = await deferredPrompt.userChoice;
    deferredPrompt = null;
    q('#installBtn').style.display='none';
  } else {
    alert('Abrí esta página en Safari y usá Compartir → Añadir a pantalla de inicio en iPhone.');
  }
});

// init
renderPlan(); renderNutrition(); renderCalendar(); renderRecords();
</script>

<script>
// register service worker (double-check)
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').catch(()=>console.log('SW registration failed'));
}
</script>
</body>
</html>
